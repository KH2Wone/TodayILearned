# JWT

<br>

## JWT가 뭘까요.

JWT는 Json Web Token의 줄임말입니다. 토큰 기반 인증 방식입니다.
일종의 입장권이라고 생각하면 쉽습니다.

<br>

## 그럼 JWT가 없었을 땐 어떻게 했을까? - 세션 기반 인증

토큰 기반의 인증 방식이 없었을 때는 서버 세션을 사용해 인증했습니다. 즉, 서버측에서 사용자의 정보를 알고 있어야 한다는 뜻입니다.  
유저가 인증을 할 때 서버가 이 기록을 **서버에 저장**하는데 이것을 세션이라고 합니다.

구현이 명확하고 서버에서 유저 상태를 확인하기 편리하다는 장점이 있습니다.
서버측에서 관리하기 때문에 클라이언트 변조에 영향을 받거나 데이터가 손상될 우려는 적습니다.

그러나 유저 수가 급격히 늘어난다면 서버의 메모리가 과부화 되겠지요.
또한 서버를 확장하기 어렵다는 단점이 있습니다. 분산된 서버의 세션을 동기화하는 작업 등이 필요하기 때문입니다.

> ### 세션 기반 인증은 어떻게 작동할까?

1. 사용자가 로그인을 시도합니다.
2. 서버에서 계정 정보를 읽고 사용자를 확인한 뒤 사용자의 고유한 ID값을 부여하여 세션 저장소에 저장하고 연결되는 세션 ID를 발행합니다.
3. 사용자는 서버에서 해당 세션ID를 받아 쿠키에 저장한 뒤 인증 요청이 있을 때마다 쿠키를 헤더에 넣어 보냅니다.
4. 서버에서 쿠키를 받아 세션 저장소에서 대조해본 뒤 대응하는 정보를 가져옵니다.
5. 인증이 완료되면 사용자에 맞는 데이터를 보내줍니다.

<br>

## 이런 문제를 해결하기 위해 JWT를 사용합니다.

토큰 기반은 stateless(상태 유지를 하지 않음)하기 때문에 유저 정보를 서버 세션에 담아두지 않습니다. 그래서 서버 메모리에 부담이 되지 않습니다.
인증 정보에 대한 별도의 저장소가 필요하지 않고 모바일에서도 사용이 가능합니다. 세션은 모바일 세션 사용이 불가능해요.

그러나 이러한 JWT도 단점은 있습니다.
Header, Payload, Signature로 이루어져 있는데 토큰의 길이가 길어서 인증 요청이 많아질수록 네트워크 부하가 심해집니다. 데이터 베이스 조회를 하지 않아 데이터 베이스는 성능적으로 이득입니다만 네트워크는 패킷이 많이 전달되어 성능 저하가 우려됩니다.  
또한 유일한(...) 토큰을 탈취당하면 대처하기 어렵겠습니다. 특정 토큰을 강제로 만료시키는 것도 어렵고요.

> ### JWT는 어떻게 작동할까?

1. 사용자가 로그인을 시도합니다.
2. 서버측에서 해당 유저의 계정 정보를 검증합니다.
3. 계정 정보가 옳다면 signed token을 발급합니다.
4. 클라이언트 측에서 전달받은 토큰을 저장해두고 서버에 요청할 때마다 해당 토큰을 함께 전달합니다.
5. 서버는 토큰을 검증하고 요청에 응답합니다.
